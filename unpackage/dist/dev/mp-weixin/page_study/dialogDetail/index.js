require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["page_study/dialogDetail/index"],{297:function(t,e,n){"use strict";(function(t,e){var o=n(4);n(26);o(n(25));var i=o(n(298));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n(1)["default"],n(2)["createPage"])},298:function(t,e,n){"use strict";n.r(e);var o=n(299),i=n(301);for(var u in i)["default"].indexOf(u)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(u);n(305);var r,c=n(32),s=Object(c["default"])(i["default"],o["render"],o["staticRenderFns"],!1,null,"7cbcb514",null,!1,o["components"],r);s.options.__file="page_study/dialogDetail/index.vue",e["default"]=s.exports},299:function(t,e,n){"use strict";n.r(e);var o=n(300);n.d(e,"render",(function(){return o["render"]})),n.d(e,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(e,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(e,"components",(function(){return o["components"]}))},300:function(t,e,n){"use strict";var o;n.r(e),n.d(e,"render",(function(){return i})),n.d(e,"staticRenderFns",(function(){return r})),n.d(e,"recyclableRender",(function(){return u})),n.d(e,"components",(function(){return o}));try{o={uSubsection:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-subsection/u-subsection")]).then(n.bind(null,479))},uCellGroup:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-cell-group/u-cell-group")]).then(n.bind(null,572))},uCell:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-cell/u-cell")]).then(n.bind(null,580))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,497))}}}catch(c){if(-1===c.message.indexOf("Cannot find module")||-1===c.message.indexOf(".vue"))throw c;console.error(c.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.iscontent?t.__map(t.detailList,(function(e,n){var o=t.__get_orig(e),i=t.getFile(e.mp3);return{$orig:o,m0:i}})):null);t._isMounted||(t.e0=function(e){t.type=2},t.e1=function(e){t.type=6}),t.$mp.data=Object.assign({},{$root:{l0:n}})},u=!1,r=[];i._withStripped=!0},301:function(t,e,n){"use strict";n.r(e);var o=n(302),i=n.n(o);for(var u in o)["default"].indexOf(u)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(u);e["default"]=i.a},302:function(t,e,n){"use strict";(function(t,o){var i=n(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var u=i(n(55)),r=i(n(57)),c=(i(n(303)),n(162)),s=n(163),a=n(304),l=function(){n.e("components/audioView/index").then(function(){return resolve(n(663))}.bind(null,n)).catch(n.oe)},d=t.getRecorderManager(),f={components:{audioView:l},data:function(){return{list:["关键词","对话"],current:0,message:[],iscontent:!1,btRecoding:!1,is_clock:!1,userSrc:"https://cloud-minapp-45998.cloud.ifanrusercontent.com/user.png",aiSrc:"https://cloud-minapp-45998.cloud.ifanrusercontent.com/ai.png",theme:"",audio_path:"",startPoint:"",audioContext:"",detail:"",nums:"",type:1,num1:100,evaluates:[],detailList:[]}},computed:{dialog:function(){var t=[];return this.message.length>0&&(this.message.sort((function(t,e){return t.sub_sequence-e.sub_sequence})),t=(0,c.groupBy)(this.message,"topic")),t},score:function(){var t=this.evaluates.reduce((function(t,e){return t+e.fluency}),0),e=this.evaluates.reduce((function(t,e){return t+e.integrity}),0),n=this.evaluates.reduce((function(t,e){return t+e.pronunciation}),0),o=this.evaluates.reduce((function(t,e){return t+e.score}),0),i={};return i.fluency=(t/this.evaluates.length).toFixed(2),i.integrity=(e/this.evaluates.length).toFixed(2),i.pronunciation=(n/this.evaluates.length).toFixed(2),i.score=(o/this.evaluates.length).toFixed(2),i},keyWords:function(){var t=Object.values(this.dialog),e=[];return t.map((function(t){console.log(t);var n=/\.([^（]+)（/g,o=/\.([^（]+)（/,i=/（([^）]+)）/g,u=/（([^）]+)）/,r=t[0].keywords.match(n),c=r.map((function(t){return t.match(o)[1]})),s=t[0].keywords.match(i),a=s.map((function(t){return t.match(u)[1]}));c.map((function(t,n){e.push({name:t,verb:a[n]})}))})),e}},methods:{change:function(t){this.current=t,0==t&&(this.iscontent=!1)},getFile:function(t){return"https://cloud-minapp-45998.cloud.ifanrusercontent.com/"+t},goback:function(){this.iscontent=!1,this.type=1},toDetail:function(t){this.iscontent=!0,this.detailList=this.dialog[t]},highlight:function(t){this.innerAudioContext.stop(),this.num1=t},beginRead:function(){this.type=3,this.nums=0,this.num1=100,this.palyAudio(this.detailList[this.nums].mp3)},palyAudio:function(t){this.num1=100,this.innerAudioContext.src="https://cloud-minapp-45998.cloud.ifanrusercontent.com/"+t,this.innerAudioContext.play(),this.innerAudioContext.onPlay((function(){console.log("开始播放")}))},showD:function(){var t=this;return(0,r.default)(u.default.mark((function e(){var n,o;return u.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,a.evaluateAudio)(t.audio_path,t.detailList[t.nums+1].sentence);case 2:return n=e.sent,o=JSON.parse(n[1].data),4==t.type&&t.evaluates.pop(),t.evaluates.push(o),e.abrupt("return",1*o.score);case 7:case"end":return e.stop()}}),e)})))()},handleRecordStart:function(t){this.num1=100,this.innerAudioContext.stop(),this.btRecoding=!0,this.is_clock=!0,this.startPoint=t.touches[0];var e={duration:1e4,format:"mp3"};d.start(e),d.onStart((function(t){console.log("开始录音")}))},handleRecordStop:function(t){var e=this;if(d.stop(),this.btRecoding=!1,!0===this.is_clock){d.onStop(function(){var t=(0,r.default)(u.default.mark((function t(n){var i;return u.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(n.duration<1e3)){t.next=4;break}o.showToast({title:"录音时间太短，请长按录音",icon:"none",duration:1e3}),t.next=9;break;case 4:return e.audio_path=n.tempFilePath,t.next=7,e.showD();case 7:i=t.sent,i>50||4==e.type?(e.type=3,e.nums+=2,e.nums>=e.detailList.length-1&&(e.type=5),e.palyAudio(e.detailList[e.nums].mp3)):e.type=4;case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},handleTouchMove:function(t){Math.abs(t.touches[t.touches.length-1].clientY-this.startPoint.clientY)>25?this.is_clock=!1:this.is_clock=!0},startRecord:function(){var t={format:"mp3"};recorder.start(t),recorder.onStart((function(){console.log("开始录音")}))},stopRecord:function(){var t=this;recorder.stop(),recorder.onStop((function(e){t.audio_path=e.tempFilePath}))}},watch:{},onLoad:function(e){var n=this;this.innerAudioContext=this.audioContext=t.createInnerAudioContext(),s.query.queryObject.$and=[],s.query.contains("text_name",e.lesson),s.learn_information_MCTdialogue.setQuery(s.query).limit(1e3).find().then((function(t){n.message=t.data.objects})),t.setNavigationBarTitle({title:e.lesson})},onReady:function(){},onShow:function(){(0,s.updateUserAction)("count_word",1)},onHide:function(){},onUnload:function(){(0,s.updateUserAction)("num_word",this.keyWords.length)}};e.default=f}).call(this,n(2)["default"],n(1)["default"])},305:function(t,e,n){"use strict";n.r(e);var o=n(306),i=n.n(o);for(var u in o)["default"].indexOf(u)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(u);e["default"]=i.a},306:function(t,e,n){}},[[297,"common/runtime","common/vendor","page_study/common/vendor"]]]);